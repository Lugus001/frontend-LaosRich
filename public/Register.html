<!DOCTYPE html> 
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      href="https://fonts.googleapis.com/css2?family=Kanit:wght@400;500;600&display=swap"
      rel="stylesheet"
    />
    <script src="https://cdn.tailwindcss.com"></script>
    <div class="bg-[#02EAD0] p-5 w-full">
      <h1 class="text-black text-right text-xl flex items-center justify-end">
        <span>Thai (TH)</span>
        <svg
          width="20"
          height="20"
          viewBox="0 0 20 20"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
          class="ml-2"
        >
          <path
            d="M5 7.5L10 12.5L15 7.5"
            stroke="white"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          />
        </svg>
      </h1>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  </head>
  
    <div
      class="min-h-screen flex flex-col items-center justify-center p-5 bg-[#116860]"
    >
      <div class="bg-[#208D83] border border-[#02EAD0] shadow-lg rounded-lg p-8 w-full max-w-md">
        <div class="flex flex-col items-center p-5">
          <img src="loaluay.png" alt="Icon" class="w-[35%]" />
        </div>
        <h2
          class="text-2xl font-bold mb-6 text-center text-[#FFFB00] font-kani"
        >
          สมัครสมาชิก
        </h2>
        <form id="registerForm">
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
            <div class="flex flex-col">
              <label for="username" class="block text-md font-medium text-white">User Name</label>
              <input
                type="text"
                id="username"
                name="username"
                required
                class="mt-1 p-2 w-full border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                placeholder="กรุณาใส่ User Name"
              />
            </div>
            <div class="flex flex-col">
              <label for="phone" class="block text-md font-medium text-white">เบอร์โทรศัพท์ผู้สมัคร</label>
              <div class="relative mt-1">
                  <div class="border border-gray-300 rounded-md flex bg-white">
                      <div class="flex items-center p-2  cursor-pointer" id="phone_prefix">
                          <div class="w-4 h-4 mr-1" /><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-chevron-down" viewBox="0 0 16 16">
                            <path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708"/>
                          </svg></div>
                      </div>
                      <input
                          type="tel"
                          id="phone"
                          name="phone"
                          required
                          class="border border-gray-300 rounded-r-md p-2 w-3/4 focus:ring-2 "
                          placeholder="กรุณาใส่เบอร์โทรศัพท์"
                      />
                  </div>
                  <!-- Dropdown options -->
                  <div class="absolute left-0 right-0 mt-1 bg-white border border-gray-300 rounded-md hidden" id="dropdown-options">
                      <div class="flex items-center p-2 cursor-pointer" onclick="selectOption('+66', 'th.svg')">
                          <img src="th.svg" class="w-4 h-4 mr-1" />
                          <span>+66 ไทย</span>
                      </div>
                      <div class="flex items-center p-2 cursor-pointer" onclick="selectOption('+856', 'laos.svg')">
                        <img src="laos.svg" class="w-4 h-4 mr-1" />
                          <span>+856 ลาว</span>
                      </div>
                  </div>
              </div>
          </div>
            <div class="flex flex-col">
              <label for="email" class="block text-md font-medium text-white">Email</label>
              <input
                type="email"
                id="email"
                name="email"
                required
                class="mt-1 p-2 w-full border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                placeholder="กรุณาใส่ Email"
              />
            </div>
            <div class="flex flex-col">
              <label for="first_name" class="block text-md font-medium text-white">ชื่อ</label>
              <input
                type="text"
                id="first_name"
                name="first_name"
                required
                class="mt-1 p-2 w-full border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                placeholder="กรุณาใส่ชื่อ"
              />
            </div>
            <div class="flex flex-col">
              <label for="last_name" class="block text-md font-medium text-white">นามสกุล</label>
              <input
                type="text"
                id="last_name"
                name="last_name"
                required
                class="mt-1 p-2 w-full border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                placeholder="กรุณาใส่นามสกุล"
              />
            </div>
            <div class="flex flex-col">
              <label for="region" class="block text-md font-medium text-white">เลือกสัญชาติ</label>
              <select
                id="region"
                name="region"
                class="border border-gray-300 rounded-md p-2 w-full focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
              >
                <option value="ไทย">ไทย</option>
                <option value="ลาว">ลาว</option>
              </select>
            </div>
            <div class="flex flex-col">
              <label for="password" class="block text-md font-medium text-white">ตั้งรหัสผ่าน</label>
              <input
                type="password"
                id="password"
                name="password"
                required
                class="mt-1 p-2 w-full border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                oninput="validatePassword()"
                placeholder="ใช้อย่างน้อย 8 ตัวอักษร"
              />
              <p id="password-alert" class="text-red-600 mt-1 hidden">รหัสผ่านของคุณใช้อย่างน้อย 8 ตัวอักษร</p>
            </div>

            <div class="flex flex-col">
              <label for="invitation_code" class="block text-md font-medium text-white">รหัสเชิญ (Optional)</label>
              <input
                  type="text"
                  id="agent_code"
                  name="agent_code"
                  class="mt-1 p-2 w-full border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                  readOnly  
              />
          </div>
          </div>

          

          <div class="flex items-center mb-4">
            <div class="flex items-center">
              <input
                type="checkbox"
                id="remember"
                name="remember"
                class="h-4 w-4 text-blue-600"
              />
              <label for="remember" class="block text-md font-medium text-white p-2">จดจำฉันไว้</label>
            </div>
          </div>

          <button
            type="submit"
            class="w-full text-white py-2 rounded-md font-semibold hover:bg-blue-700 font-kanit"
            style="background: linear-gradient(to right, #22c55e 0%, #f8bb54 100%);"
          >
            สมัครสมาชิก
          </button>
        </form>

        <div class="flex items-center justify-center my-8">
          <h1 class="text-white text-md pr-1">มีบัญชีแล้ว?</h1>
          <a href="../login.html" class="text-[#FFFB00] text-md">ลงชื่อเข้าใช้</a>
        </div>

       <!--
        <div class="flex justify-center pt-2">
          <button
            id="googleLoginButton"
            type="button"
            class="w-full text-gray-500 py-3 rounded-md bg-white border border-gray-400 text-sm hover:bg-gray-300 flex items-center justify-center"
          >
            <div class="pr-2">
              <img src="ggImg.svg" alt="Google Logo" />
            </div>
            ลงชื่อเข้าใช้งานด้วย Google
          </button>
        </div>
        -->

        <!--
        <div class="flex justify-center pt-2">
          <button
            type="button"
            class="w-full text-gray-500 py-3 rounded-md bg-white border border-gray-400 text-sm hover:bg-gray-300 flex items-center justify-center"
          >
            <div class="pr-2">
              <img src="line.svg" alt="Line Logo" />
            </div>
            ลงชื่อเข้าใช้งานด้วย Line
          </button>
        </div>
        -->
      </div>
    </div>
    <script>
      function validatePassword() {
        const password = document.getElementById("password").value;
        const passwordAlert = document.getElementById("password-alert");
        if (password.length < 8) {
          passwordAlert.classList.remove("hidden");
        } else {
          passwordAlert.classList.add("hidden");
        }
      }

      const form = document.getElementById("registerForm");
    

      form.addEventListener("submit", async function (e) {
  e.preventDefault();
  const phone_prefix_span = document.querySelector("#phone_prefix span");
  const phone_prefix = phone_prefix_span ? phone_prefix_span.textContent.trim() : '';
  const phone = document.getElementById("phone").value;
  const email = document.getElementById("email").value;
  const first_name = document.getElementById("first_name").value;
  const last_name = document.getElementById("last_name").value;
  const region = document.getElementById("region").value;
  const password = document.getElementById("password").value;
  const username = document.getElementById("username").value;

  console.log({ username, password, phone_prefix, phone, email, first_name, last_name, region });

  if (!username || !password || !phone || !phone_prefix || !region) {
    Swal.fire('Missing Fields', 'Please fill in all required fields.', 'error');
    return;
  }

  const registrationData = {
    username,
    phone_prefix,
    phone,
    email,
    first_name,
    last_name,
    region,
    password,
  };

  try {
    const response = await fetch("http://192.168.1.154:8899/laosruey/api/v1/register", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify(registrationData),
    });

    const result = await response.json();

    if (response.ok) {
      console.log(result);
      localStorage.setItem('token', result.token);
      Swal.fire('Register Successful', 'Welcome!', 'success');
      window.location.href = '/login.html';
    } else {
      Swal.fire('Register Failed', result.message || 'An error occurred', 'error');
    }
  } catch (error) {
    console.error('Error:', error);
    Swal.fire('Error', 'There was a problem with your request.', 'error');
  }
});

    </script>
    <script>
      async function fetchOrderData() {
        try {
          const token = localStorage.getItem('token'); 
          if (!token) {
                    throw new Error('No token found');
                }

          const response = await fetch('http://192.168.1.154:8899/laosruey/api/v1/orders', {
            method: 'GET', 
            headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${token}` 

            },
        });

        if (!response.ok) {
            throw new Error(`HTTP error! Status: ${response.status}`);
        }

        const data = await response.json();

        const agentCode = data.agent_code; 
        console.log(`Agent Code: ${agentCode}`);

        document.getElementById('agent_code').value = agentCode;


        const newUrl = window.location.protocol + "//" + window.location.host + window.location.pathname + `?agent_code=${agentCode}`;
        window.history.pushState({ path: newUrl }, '', newUrl);

        
    } catch (error) {
        console.error("Error fetching order data:", error);
    }
}
    fetchOrderData();

    </script>
    

    <script>
      const phonePrefix = document.getElementById('phone_prefix');
      const dropdown = document.getElementById('dropdown-options');
  
      phonePrefix.addEventListener('click', () => {
          dropdown.classList.toggle('hidden');
      });
  
      function selectOption(prefix, imgSrc) {
          phonePrefix.innerHTML = `
              ${imgSrc ? `<img src="${imgSrc}" class="w-4 h-4 mr-1" />` : ''}
              <span>${prefix}</span>
          `;
          dropdown.classList.add('hidden');
      }
  
      // Close dropdown when clicking outside
      document.addEventListener('click', (event) => {
          if (!phonePrefix.contains(event.target) && !dropdown.contains(event.target)) {
              dropdown.classList.add('hidden');
          }
      });
  </script>
  
  </body>
</html>